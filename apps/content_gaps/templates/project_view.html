{% extends 'base.html' %}
{% block title %}Project Dashboard | Content Gaps{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto p-6">
    <a href="{{ url_for('content_gaps.index') }}" class="text-green-600 hover:underline">&larr; Back to Projects</a>
    <h1 class="text-2xl font-bold text-green-700 mt-4 mb-2">{{ project.project_name if project else 'Project Dashboard' }}</h1>
    <div class="bg-white rounded-lg shadow p-6 mt-4">
        <!-- Topic Trees Section -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-2">
                <h2 class="text-lg font-semibold text-green-800">Topic Trees</h2>
                <a href="{{ url_for('content_gaps.create_topic_tree', project_id=project_id) }}" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">+ New Topic Tree</a>
            </div>
            {% if topic_trees and topic_trees|length > 0 %}
                <form method="post" action="{{ url_for('content_gaps.run_topic_matching', project_id=project_id) }}" class="mb-6 flex flex-col md:flex-row md:items-end md:space-x-4">
                    <div>
                        <label for="topic_tree_id" class="block text-sm font-medium text-gray-700 mb-1">Select Topic Tree</label>
                        <select name="topic_tree_id" id="topic_tree_id" class="form-select w-full border border-gray-300 rounded px-3 py-2">
                            {% for tree in topic_trees %}
                                <option value="{{ tree.tree_id }}">{{ tree.tree_name }} ({{ tree.root_topic }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mt-4 md:mt-0">Run Topic Matching</button>
                </form>
                <ul class="divide-y divide-gray-200 mb-2">
                    {% for tree in topic_trees %}
                    <li class="py-3 flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <div class="font-bold text-green-700">{{ tree.tree_name }}</div>
                            <div class="text-sm text-gray-500">Root Topic: {{ tree.root_topic }}</div>
                        </div>
                        <div class="mt-2 md:mt-0 flex gap-2">
                            <a href="{{ url_for('content_gaps.edit_topic_tree_vertical', project_id=project_id, tree_id=tree.tree_id) }}" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">Vertical Edit</a>
                            <a href="{{ url_for('content_gaps.edit_topic_tree', project_id=project_id, tree_id=tree.tree_id) }}" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">Horizontal Edit</a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <div class="text-gray-500 mb-2">No topic trees found. Click "+ New Topic Tree" to get started.</div>
            {% endif %}
        </div>
        <!-- Uploaded Content Section -->
        <div class="border-t border-gray-200 pt-6 mt-6">
            <div class="flex items-center justify-between mb-2">
                <h2 class="text-lg font-semibold text-green-800">Uploaded Content</h2>
                <a href="{{ url_for('content_gaps.upload_site_content', project_id=project_id) }}" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">+ Upload Site Content</a>
            </div>
            {% if sites and sites|length > 0 %}
                <ul class="divide-y divide-gray-200">
                    {% for site in sites %}
                    <li class="py-3 flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <div class="font-bold text-green-700">{{ site.label }}</div>
                            <div class="text-sm text-gray-500">Pages: {{ site.pages|length }}</div>
                            {% if site.is_my_site %}
                                <span class="inline-block bg-green-100 text-green-700 text-xs px-2 py-1 rounded mt-1">My Site</span>
                            {% endif %}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <div class="text-gray-500">No site content uploaded. Click "+ Upload Site Content" to add your first site.</div>
            {% endif %}
        </div>
        <p class="text-gray-500 mt-8">Primary URL: {{ project.primary_url if project else '' }}</p>
    </div>
</div>
{% endblock %} 